# ==========================================
# STYLOFITNESS - Configuración Apache OPTIMIZADA
# ==========================================

# Habilitar motor de reescritura
RewriteEngine On

# IMPORTANTE: Definir la base correcta para evitar problemas de URLs
RewriteBase /stylofitness/

# ==========================================
# REGLAS DE REESCRITURA PRINCIPALES
# ==========================================

# No reescribir archivos que existen físicamente
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# No reescribir para directorios específicos
RewriteCond %{REQUEST_URI} !^/stylofitness/(public|uploads|api|admin|vendor|node_modules)/ [NC]

# Reescribir todas las demás peticiones al index.php
RewriteRule ^(.*)$ index.php [L,QSA]

# ==========================================
# SEGURIDAD BÁSICA
# ==========================================

# Prevenir acceso a archivos de configuración
<Files ~ "^\.">
    Require all denied
</Files>

# Proteger archivos sensibles
<FilesMatch "\.(env|log|sql|md|json|lock|htaccess|htpasswd)$">
    Require all denied
</FilesMatch>

# Prevenir ejecución de PHP en uploads
<Directory "public/uploads">
    php_flag engine off
    AddType text/plain .php .php3 .phtml .pht
</Directory>

# Headers de seguridad básicos
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# ==========================================
# CONFIGURACIÓN PHP
# ==========================================

# Aumentar límites para uploads
php_value upload_max_filesize 50M
php_value post_max_size 50M
php_value max_execution_time 300
php_value memory_limit 256M

# Configuración de sesiones
php_value session.gc_maxlifetime 7200
php_value session.cookie_lifetime 0

# ==========================================
# CONFIGURACIÓN GENERAL
# ==========================================

# Charset UTF-8
AddDefaultCharset UTF-8

# Optimización de índices
DirectoryIndex index.php index.html

# Prevenir acceso directo a directorios
Options -Indexes

# Seguir enlaces simbólicos
Options +FollowSymLinks

# Multi-views off para mejor performance
Options -MultiViews

# ==========================================
# TIPOS MIME ADICIONALES
# ==========================================

AddType image/webp .webp
AddType video/webm .webm
AddType video/mp4 .mp4
AddType font/woff .woff
AddType font/woff2 .woff2

# ==========================================
# COMPRESIÓN BÁSICA
# ==========================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# ==========================================
# ERRORES PERSONALIZADOS
# ==========================================

# Redirigir errores 404 a nuestra aplicación
ErrorDocument 404 /stylofitness/index.php

# ==========================================
# DEBUG (comentar en producción)
# ==========================================

# Para debug, descomentar estas líneas:
# RewriteLog logs/rewrite.log
# RewriteLogLevel 3
